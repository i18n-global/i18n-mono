# v1.5.1 Release Notes

**Release Date:** October 20, 2025

## ðŸŽ¯ Major Features - Type Safety & Enhanced Constant Handling

This release introduces comprehensive TypeScript support and significantly improved constant handling capabilities, making i18nexus-tools more type-safe and intelligent about data sources.

### âœ¨ TypeScript Configuration Support

#### New Configuration Options

- **NEW**: `i18nexus.config.ts` support for TypeScript configuration files
- **NEW**: Type inference for language codes with `as const`
- **NEW**: `--typescript` flag for `i18n-sheets init` command
- **NEW**: Auto-detection of config files (`.ts` > `.js` > `.json`)
- **NEW**: `translationImportSource` configuration option

#### TypeScript Config Example

```typescript
import { defineConfig } from "i18nexus";

export const config = defineConfig({
  languages: ["en", "ko"] as const,
  defaultLanguage: "ko",
  localesDir: "./locales",
  sourcePattern: "src/**/*.{ts,tsx,js,jsx}",
  translationImportSource: "i18nexus",
  googleSheets: {
    spreadsheetId: "your-spreadsheet-id",
    credentialsPath: "./credentials.json",
    sheetName: "Translations",
  },
});

// Export the language union type for type safety
export type AppLanguages = (typeof config.languages)[number];
```

#### Type Safety Benefits

- **Language type inference**: `AppLanguages` type for type-safe language switching
- **Configuration validation**: TypeScript catches configuration errors at compile time
- **IDE support**: Better autocomplete and error detection
- **Refactoring safety**: Type-safe refactoring across the project

### âœ¨ Enhanced Constant Handling

#### AST-based Constant Analysis

- **FIX/FEATURE**: `i18n-wrapper` now detects top-level `const` arrays/objects (including those imported from other files)
- **FIX/FEATURE**: Wraps JSX usages like `{item.label}` with `t(...)` when the underlying constant contains Korean strings (1-depth analysis)
- **FIX/FEATURE**: Avoids mutating runtime constants and wraps at usage sites
- **FIX/FEATURE**: `i18n-extractor` can now trace `t(item.prop)` back to constants (internal and external) and extract literal Korean values into `locales/*.json`

#### Smart Data Source Detection

- **IMPROVED**: Excludes dynamic data sources (API, props, useState, function params) from automatic wrapping
- **NEW**: `constantPatterns` config option to customize variable name heuristics for constants (e.g., uppercase, suffix/prefix matching)

#### Usage Examples

**Constant Detection:**

```tsx
const NAV_ITEMS = [
  { path: "/home", label: "í™ˆ" },
  { path: "/about", label: "ì†Œê°œ" },
];

function Navigation() {
  return NAV_ITEMS.map((item) => (
    // item.label automatically wrapped with t(item.label)
    <a href={item.path}>{item.label}</a>
  ));
}
```

**Dynamic Data Exclusion:**

```tsx
// API data from useState - NOT wrapped
const [users, setUsers] = useState([]);

// Props data - NOT wrapped
function List({ items }) {
  return items.map((item) => <div>{item.label}</div>);
}
```

### âœ¨ Enhanced CLI Tools

#### Improved Configuration Loading

- **IMPROVED**: `i18n-wrapper` now respects `translationImportSource` config
- **IMPROVED**: `i18n-sheets init` can generate TypeScript config files
- **IMPROVED**: Better error messages for config file issues
- **IMPROVED**: Async config loading for better performance

#### Custom Import Sources

- **NEW**: `translationImportSource` configuration option
- **NEW**: Customize where `i18n-wrapper` imports from
- **NEW**: Default value: `"i18nexus"`
- **NEW**: Supports custom paths like `"@/lib/i18n"`

### ðŸ”§ Technical Improvements

#### CLI Tools

- **IMPROVED**: Better TypeScript definitions for all tools
- **IMPROVED**: More precise type constraints for generic parameters
- **IMPROVED**: Export config types for reusability

#### Documentation

- **IMPROVED**: README with type safety examples
- **IMPROVED**: Better error messages and help text
- **IMPROVED**: Examples with TypeScript configuration

### ðŸ› Bug Fixes

- Fixed async config loading in bin scripts
- Fixed linter errors related to `any` types
- Fixed type assertions in language switching

---

## Migration Guide

### From v1.5.0

#### Breaking Changes

- `loadConfig()` is now async and returns a `Promise`
- Config file priority changed: `.ts` > `.js` > `.json`

#### Migration Steps

1. **Update to TypeScript config (optional):**

   ```bash
   npx i18n-sheets init --typescript
   ```

2. **Update config loading in custom scripts:**

   ```typescript
   // Before
   const config = loadConfig();

   // After
   const config = await loadConfig();
   ```

3. **Use type-safe language switching:**

   ```typescript
   import type { AppLanguages } from "./i18nexus.config";

   const { changeLanguage } = useLanguageSwitcher<AppLanguages>();
   ```

### Recommended Actions

1. **Migrate to TypeScript config** for better type safety
2. **Update custom scripts** to handle async config loading
3. **Use type-safe language switching** with `AppLanguages` type

---

## Full Changelog

- **NEW**: `i18nexus.config.ts` support for TypeScript configuration files
- **NEW**: Type inference for language codes with `as const`
- **NEW**: `--typescript` flag for `i18n-sheets init` command
- **NEW**: Auto-detection of config files (`.ts` > `.js` > `.json`)
- **NEW**: `translationImportSource` configuration option
- **IMPROVED**: `i18n-wrapper` now respects `translationImportSource` config
- **IMPROVED**: `i18n-sheets init` can generate TypeScript config files
- **IMPROVED**: Better error messages for config file issues
- **IMPROVED**: Async config loading for better performance
- **IMPROVED**: Better TypeScript definitions for all tools
- **IMPROVED**: More precise type constraints for generic parameters
- **IMPROVED**: Export config types for reusability
- **IMPROVED**: README with type safety examples
- **IMPROVED**: Better error messages and help text
- **IMPROVED**: Examples with TypeScript configuration
- **FIX**: `i18n-wrapper` now detects top-level `const` arrays/objects (including imported)
- **FIX**: Wraps JSX usages like `{item.label}` with `t(...)` when constant contains Korean strings
- **FIX**: Avoids mutating runtime constants and wraps at usage sites
- **FIX**: `i18n-extractor` can now trace `t(item.prop)` back to constants
- **FIX**: Excludes dynamic data sources (API, props, useState, function params) from wrapping
- **FIX**: Added `constantPatterns` config option for variable name heuristics
- **FIX**: Async config loading in bin scripts
- **FIX**: Linter errors related to `any` types
- **FIX**: Type assertions in language switching
