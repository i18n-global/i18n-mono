# v1.5.7 Release Notes

**Release Date:** January 26, 2025

## ğŸ¯ Major Feature - Intelligent Context-Based Wrapping

This release introduces revolutionary improvements to the `i18n-wrapper` tool, making it significantly smarter about what content to wrap and how to handle different contexts.

### âœ¨ New Features

#### Template Literal Support

Automatically converts template literals to i18next interpolation format:

**Before:**

```tsx
<h1>{`í™˜ì˜í•©ë‹ˆë‹¤`}</h1>
<p>{`ì‚¬ìš©ì: ${count}ëª…`}</p>
<span>{`ì´ë¦„: ${user.name}`}</span>
```

**After:**

```tsx
<h1>{t("í™˜ì˜í•©ë‹ˆë‹¤")}</h1>
<p>{t("ì‚¬ìš©ì: {{count}}ëª…", { count })}</p>
<span>{t("ì´ë¦„: {{user_name}}", { user_name: user.name })}</span>
```

**Conversion Rules:**

- `${ë³€ìˆ˜}` â†’ `{{ë³€ìˆ˜}}` + interpolation object
- `${obj.prop}` â†’ `{{obj_prop}}` (dots converted to underscores)
- `${í‘œí˜„ì‹}` â†’ `{{expr0}}` (complex expressions auto-numbered)

#### Server Component Auto-Detection

Intelligently detects server components and prevents unnecessary hook injection:

**Server Component (No useTranslation hook added):**

```tsx
export default async function ServerPage() {
  const { t } = await getServerTranslation();
  return <h1>{t("ì„œë²„ì—ì„œ ë Œë”ë§")}</h1>;
}
```

**Client Component (useTranslation hook auto-added):**

```tsx
"use client";
export default function ClientPage() {
  // const { t } = useTranslation(); <- Auto-injected
  return <h1>{t("í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë Œë”ë§")}</h1>;
}
```

#### Context-Based Data Source Tracking

Revolutionary feature that distinguishes between static constants and dynamic data:

**âœ… Auto-wrapped (Static Constants):**

```tsx
const NAV_ITEMS = [
  { path: "/home", label: "í™ˆ" },
  { path: "/about", label: "ì†Œê°œ" },
];

function Navigation() {
  return NAV_ITEMS.map((item) => (
    // item.label automatically wrapped with t(item.label)
    <a href={item.path}>{item.label}</a>
  ));
}
```

**âŒ Auto-excluded (Dynamic Data):**

```tsx
// API data from useState
const [users, setUsers] = useState([]);

// Props data
function List({ items }) {
  return items.map((item) => <div>{item.label}</div>);
}

// Hook-based data
const { data } = useQuery("/api/data");
```

### ğŸ”§ Technical Improvements

#### Enhanced Data Source Detection

- **NEW**: `isFromPropsOrParams()` with destructuring support
- **NEW**: `isServerComponent()` method to detect `getServerTranslation` usage
- **IMPROVED**: `isDynamicData()` catches more API/hook patterns
- **IMPROVED**: Better constant analysis with external file import support
- **NEW**: Added `flatMap` to array method detection

#### Auto-excluded Data Sources

- `useState`, `useEffect`, `useQuery` ë“±ì˜ React í›…ì—ì„œ ì˜¨ ë°ì´í„°
- `fetch`, `axios` ë“± API í˜¸ì¶œ ê²°ê³¼
- í•¨ìˆ˜ì˜ propsë‚˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœ ë°ì´í„°
- `let`, `var`ë¡œ ì„ ì–¸ëœ ë™ì  ë³€ìˆ˜
- ë°°ì—´ êµ¬ì¡° ë¶„í•´ í• ë‹¹ (ì˜ˆ: `const [data, setData] = useState()`)

#### Auto-processed Data Sources

- `const`ë¡œ ì„ ì–¸ëœ ì •ì  ìƒìˆ˜ (ALL_CAPS, PascalCase)
- ì™¸ë¶€ íŒŒì¼ì—ì„œ importëœ ìƒìˆ˜
- í•œêµ­ì–´ ë¬¸ìì—´ì„ í¬í•¨í•œ ê°ì²´/ë°°ì—´ ë¦¬í„°ëŸ´
- `label`, `title`, `text`, `name`, `placeholder` ë“± ë Œë”ë§ ê°€ëŠ¥í•œ ì†ì„±

### ğŸ¯ Benefits

- **Safer automatic wrapping**: Only processes static, translatable content
- **Less manual cleanup**: API data and dynamic content automatically excluded
- **Better Next.js support**: Proper server/client component handling
- **Smarter detection**: Traces data from declaration to usage
- **Fewer false positives**: Understands context and data flow

### ğŸ› Bug Fixes

- Fixed empty string filtering in wrapper
- Improved AST parsing for better comment detection
- Enhanced error handling for malformed files

### ğŸ“¦ Dependencies

No new dependencies added. All existing dependencies maintained.

---

## Migration Guide

### From v1.5.6

No breaking changes. This is a pure enhancement release.

### Recommended Workflow

1. **Run wrapper on existing code:**

   ```bash
   npx i18n-wrapper --dry-run
   ```

2. **Review changes** - the tool is now much smarter about what to wrap

3. **Apply changes:**

   ```bash
   npx i18n-wrapper
   ```

4. **Extract new keys:**
   ```bash
   npx i18n-extractor
   ```

---

## Full Changelog

- **NEW**: Template literal support with i18next interpolation conversion
- **NEW**: Server component auto-detection prevents unnecessary hook injection
- **NEW**: Context-based data source tracking distinguishes static vs dynamic data
- **NEW**: API data pattern detection excludes useState, useEffect, fetch, axios
- **NEW**: Props and parameter detection excludes function parameters and props
- **IMPROVED**: Constant analysis tracks data flow from source to usage
- **IMPROVED**: Only wraps data from static const declarations, not API/dynamic sources
- **IMPROVED**: Better handling of array methods (map, filter, etc.) in constant iteration
- **IMPROVED**: Enhanced isFromPropsOrParams() with destructuring support
- **IMPROVED**: Better constant analysis with external file import support
- **FIX**: Empty string filtering in wrapper
- **FIX**: Improved AST parsing for better comment detection
- **FIX**: Enhanced error handling for malformed files
