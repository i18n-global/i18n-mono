# v1.5.4 Release Notes

**Release Date:** January 21, 2025

## ğŸ¯ Feature - Clean Legacy Keys & Ignore Comments

This release introduces powerful cleanup capabilities and ignore comment support to make the i18n workflow more flexible and maintainable.

### âœ¨ New Command: i18n-clean-legacy

#### Features

- **NEW**: `i18n-clean-legacy` command to remove unused and invalid translation keys
- Analyzes source code using extractor logic to find actively used keys
- Compares with locale files and removes unused keys
- Removes keys with invalid values ("\_N/A", "N/A", "", null, undefined)
- Reports missing keys (used in code but not in locale)
- Creates timestamped backup files before modifications
- Supports dry-run mode to preview changes

#### Usage Examples

```bash
# Preview what would be removed
npx i18n-clean-legacy --dry-run

# Clean up unused keys with backup
npx i18n-clean-legacy

# Clean without backup
npx i18n-clean-legacy --no-backup

# Custom pattern and languages
npx i18n-clean-legacy -p "app/**/*.tsx" -l "en,ko,ja"
```

#### What Gets Removed

- Keys that exist in locale files but are not used in code
- Keys with invalid values ("\_N/A", "N/A", "", null, undefined)
- Orphaned keys from refactored code

#### What Gets Reported

- Keys used in code but missing from locale files
- Statistics on cleanup operations
- Backup file locations

### âœ¨ Wrapper Ignore Comment Support

#### Features

- **NEW**: `// i18n-ignore` or `/* i18n-ignore */` comment support in wrapper
- Place comment directly above code to skip wrapping
- Works with JSX elements, string literals, and expressions
- Useful for preserving intentionally untranslated strings

#### Usage Examples

**JSX Elements:**

```tsx
export default function Example() {
  return (
    <div>
      {/* ì¼ë°˜ í…ìŠ¤íŠ¸ - ë˜í•‘ë¨ */}
      <h1>ì•ˆë…•í•˜ì„¸ìš”</h1>

      {/* i18n-ignore */}
      <p>ì´ê²ƒì€ ë¬´ì‹œë©ë‹ˆë‹¤</p>

      {/* i18n-ignore */}
      <span>{"ì´ê²ƒë„ ë¬´ì‹œë©ë‹ˆë‹¤"}</span>
    </div>
  );
}
```

**Object Properties:**

```tsx
const CONFIG = {
  // i18n-ignore
  apiKey: "í•œê¸€ë¡œ ëœ API í‚¤",
  // ì¼ë°˜ ì¼€ì´ìŠ¤ - ë˜í•‘ë¨
  message: "í™˜ì˜í•©ë‹ˆë‹¤",
};
```

**String Literals:**

```tsx
// i18n-ignore
const apiKey = "í•œê¸€ API í‚¤";

// ì¼ë°˜ ì¼€ì´ìŠ¤ - ë˜í•‘ë¨
const welcomeMessage = "í™˜ì˜í•©ë‹ˆë‹¤";
```

### ğŸ¯ Benefits

#### Clean Legacy Keys

- **Maintainable codebase**: Remove unused translation keys automatically
- **Cleaner locale files**: No more orphaned or invalid keys
- **Safe operations**: Automatic backup before cleanup
- **Flexible filtering**: Custom patterns and language selection

#### Ignore Comments

- **Selective wrapping**: Choose what to translate and what to skip
- **API data protection**: Prevent wrapping of API keys, URLs, etc.
- **Flexible control**: Works with any JSX element or expression
- **Clear intent**: Comments make exclusion decisions explicit

### ğŸ”§ Technical Details

#### Clean Legacy Implementation

- Uses same extraction logic as `i18n-extractor` to find used keys
- Compares against locale files to identify unused keys
- Validates key values to identify invalid entries
- Creates timestamped backups: `locales/en.json.backup.20250121-143022`

#### Ignore Comment Implementation

- Comments are attached to AST nodes using `attachComment: true`
- Source code line analysis for JSX comments
- Supports both line comments (`//`) and block comments (`/* */`)
- Works with all JSX element types and expressions

---

## Migration Guide

### From v1.5.2

No breaking changes. This is a feature addition release.

### Recommended Actions

1. **Clean up existing unused keys:**

   ```bash
   npx i18n-clean-legacy --dry-run
   npx i18n-clean-legacy
   ```

2. **Add ignore comments where needed:**

   ```tsx
   // i18n-ignore
   const apiKey = "í•œê¸€ API í‚¤";
   ```

3. **Update workflow** to include cleanup step

### Workflow Integration

**Regular Development:**

```bash
# Add new features
npx i18n-wrapper
npx i18n-extractor

# Periodically clean up
npx i18n-clean-legacy
```

**Before Releases:**

```bash
# Clean up unused keys
npx i18n-clean-legacy --no-backup
```

---

## Full Changelog

- **NEW**: `i18n-clean-legacy` command to remove unused and invalid translation keys
- **NEW**: Analyzes source code using extractor logic to find actively used keys
- **NEW**: Compares with locale files and removes unused keys
- **NEW**: Removes keys with invalid values ("\_N/A", "N/A", "", null, undefined)
- **NEW**: Reports missing keys (used in code but not in locale)
- **NEW**: Creates timestamped backup files before modifications
- **NEW**: Supports dry-run mode to preview changes
- **NEW**: `// i18n-ignore` or `/* i18n-ignore */` comment support in wrapper
- **NEW**: Place comment directly above code to skip wrapping
- **NEW**: Works with JSX elements, string literals, and expressions
- **NEW**: Useful for preserving intentionally untranslated strings
- **IMPROVED**: Comments are attached to AST nodes using `attachComment: true`
- **IMPROVED**: Source code line analysis for JSX comments
- **IMPROVED**: Supports both line comments (`//`) and block comments (`/* */`)
