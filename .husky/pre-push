# CI í™˜ê²½ì—ì„œëŠ” ìŠ¤í‚µ
if [ -n "$CI" ]; then
  echo "â­ï¸  CI environment detected, skipping pre-push hook"
  exit 0
fi

echo "ğŸ” Running pre-push checks..."

# í˜„ì¬ ë¸Œëœì¹˜ í™•ì¸
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

# main ë¸Œëœì¹˜ë¡œ ì§ì ‘ push ê²½ê³  (ì¸í„°ë™í‹°ë¸Œ í™˜ê²½ì—ì„œë§Œ)
if [ "$CURRENT_BRANCH" = "main" ] && [ -t 0 ]; then
  echo "âš ï¸  main ë¸Œëœì¹˜ë¡œ ì§ì ‘ pushí•˜ëŠ” ê²ƒì€ ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
  echo "ğŸ’¡ Pull Requestë¥¼ í†µí•´ ë³€ê²½ì‚¬í•­ì„ ê²€í† í•˜ì„¸ìš”."
  echo ""
  read -p "ì •ë§ main ë¸Œëœì¹˜ë¡œ pushí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (yes/no): " -r
  if [ "$REPLY" != "yes" ]; then
    echo "âŒ Pushê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."
    exit 1
  fi
  echo "âš ï¸  ê°•ì œ pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤..."
fi

# ë¦°íŠ¸ ì‹¤í–‰ (ì„ íƒì ìœ¼ë¡œ ë³€ê²½)
echo "ğŸ” Running prettier on changed files..."
git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|json|md)$' | xargs -r npx prettier --check || {
  echo "âš ï¸  Prettier check failed, but continuing..."
  echo "ğŸ’¡ Files will be formatted in CI."
}

echo "âœ… Pre-push checks completed!"
